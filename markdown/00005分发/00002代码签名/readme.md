# ä»£ç ç­¾å

ä»£ç ç­¾åæ˜¯ä¸€ç§ç”¨æ¥è¯æ˜åº”ç”¨æ˜¯ç”±ä½ åˆ›å»ºçš„ä¸€ç§å®‰å…¨æŠ€æœ¯ã€‚

<br>

macOS ç³»ç»Ÿèƒ½é€šè¿‡ä»£ç ç­¾åæ£€æµ‹å¯¹appçš„ä»»ä½•ä¿®æ”¹ï¼ŒåŒ…æ‹¬æ„å¤–ä¿®æ”¹å’Œæ¥è‡ªæ¶æ„ä»£ç çš„ä¿®æ”¹ã€‚

<br>

åœ¨Windowsç³»ç»Ÿä¸­ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰ä»£ç ç­¾åè¯ä¹¦ï¼Œæˆ–è€…ä»£ç ç­¾åæˆä¿¡çº§åˆ«è¾ƒä½æ—¶ï¼Œç³»ç»ŸåŒæ ·ä¼šå°†å…¶åˆ—ä¸ºå¯ä¿¡ç¨‹åºï¼Œåªæ˜¯å½“ç”¨æˆ·è¿è¡Œè¯¥åº”ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºå®‰å…¨æç¤ºã€‚ ä¿¡ä»»çº§åˆ«éšç€æ—¶é—´çš„æ¨ç§»æ„å»ºï¼Œå› æ­¤æœ€å¥½å°½æ—©å¼€å§‹ä»£ç ç­¾åã€‚

<br>

å³ä½¿å¼€å‘è€…å¯ä»¥å‘å¸ƒä¸€ä¸ªæœªç­¾åçš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å»ºè®®è¿™æ ·åšã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒWindows å’Œ macOS éƒ½ä¼šç¦æ­¢æœªç­¾åçš„åº”ç”¨çš„ä¸‹è½½æˆ–è¿è¡Œã€‚ ä» macOS Catalina (10.15ç‰ˆæœ¬) å¼€å§‹ï¼Œç”¨æˆ·éœ€è¦æ“ä½œå¾ˆå¤šä¸ªæ­¥éª¤æ¥è¿è¡Œä¸€ä¸ªæœªç­¾åçš„åº”ç”¨ã€‚

<br>

macOS Catalina Gatekeeper å°†ç›´æ¥è­¦å‘Šï¼šæ— æ³•æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå¼€å‘è€…æ— æ³•éªŒè¯../images/gatekeeper.png)

<br>

å¦‚ä½ æ‰€è§ï¼Œç”¨æˆ·æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šç›´æ¥åˆ é™¤åº”ç”¨æˆ–è€…å–æ¶ˆè¿è¡Œã€‚ ä½ ä¸ä¼šæƒ³è®©ç”¨æˆ·çœ‹è§è¯¥å¯¹è¯æ¡†ã€‚

<br>

å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€æ¬¾Electronåº”ç”¨ï¼Œå¹¶æ‰“ç®—å°†å…¶æ‰“åŒ…å‘å¸ƒï¼Œé‚£ä½ å°±åº”è¯¥ä¸ºå…¶æ·»åŠ ä»£ç ç­¾åã€‚

## ç­¾å & è®¤è¯ macOS ç‰ˆæœ¬

æ­£ç¡®å‡†å¤‡ macOS åº”ç”¨ç¨‹åºçš„å‘å¸ƒéœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š

<br>

- é¦–å…ˆï¼Œåº”ç”¨ç¨‹åºéœ€è¦ç­¾åã€‚
- ç„¶åï¼Œåº”ç”¨ç¨‹åºéœ€è¦ä¸Šä¼ åˆ°è‹¹æœï¼Œç„¶åæ‰èƒ½è¿›è¡Œåä¸ºâ€œå…¬è¯â€çš„è¿‡ç¨‹ï¼Œ è‡ªåŠ¨åŒ–ç³»ç»Ÿå°†ä¼šè¿›ä¸€æ­¥éªŒè¯æ‚¨çš„åº”ç”¨æ²¡æœ‰åšä»»ä½•äº‹æƒ…æ¥å±åŠå…¶ç”¨æˆ·ã€‚

<br>

è‹¥è¦å¼€å§‹ï¼Œè¯·ç¡®ä¿ä½ æ»¡è¶³ç­¾åè¦æ±‚å¹¶è®¤è¯ä½ çš„åº”ç”¨ï¼š

<br>

- åŠ å…¥ (Apple Developer Program)[https://developer.apple.com/programs/] (éœ€è¦ç¼´çº³å¹´è´¹)
- ä¸‹è½½å¹¶å®‰è£… (Xcode)[https://developer.apple.com/xcode] - è¿™éœ€è¦ä¸€å°è¿è¡Œ macOS çš„è®¡ç®—æœºã€‚
- ç”Ÿæˆï¼Œä¸‹è½½ï¼Œç„¶åå®‰è£…(ç­¾åè¯ä¹¦ï¼ˆsigning certificatesï¼‰)[https://github.com/electron/electron-osx-sign/wiki/1.-Getting-Started#certificates]

<br>

Electron çš„ç”Ÿæ€ç³»ç»Ÿæœ‰åˆ©äºé…ç½®å’Œè‡ªç”±ï¼Œæ‰€ä»¥æœ‰å¤šç§æ–¹æ³•è®©æ‚¨çš„åº”ç”¨ç¨‹åºç­¾åå’Œå…¬è¯ã€‚

#### electron-forge

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Electron æœ€å—æ¬¢è¿çš„æ„å»ºå·¥å…·ï¼Œåˆ›å»ºä½ çš„åº”ç”¨ç¨‹åºç­¾å å¹¶ç»è¿‡å…¬è¯ä»…éœ€è¦å¯¹é…ç½®è¿›è¡Œä¸€äº›æ·»åŠ å³å¯ã€‚ (Forge)[https://electronforge.io/] æ˜¯å®˜æ–¹çš„ Electron å·¥å…·çš„ é›†åˆï¼Œåœ¨hoodä¸‹ä½¿ç”¨ (`electron-packager`)[https://github.com/electron/electron-packager] (electron-osx-sign)[https://github.com/electron-userland/electron-osx-sign] (electron-notarize)[https://github.com/electron/electron-notarize] ã€‚

<br>

è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ‰€æœ‰å¿…éœ€å­—æ®µçš„ç¤ºä¾‹é…ç½®ã€‚ å¹¶ä¸æ˜¯æ‰€æœ‰éƒ½æ˜¯å¿…éœ€çš„ï¼šå·¥å…·éå¸¸èªæ˜è¶³ä»¥è‡ªåŠ¨æ‰¾åˆ°åˆé€‚çš„ `identity`, ä¾‹å¦‚ï¼Œä½†æˆ‘ä»¬å»ºè®®ä½ æ˜ç™½æ— è¯¯ã€‚

<br>

```
{
  "name": "my-app",
  "version": "0.0.1",
  "config": {
    "forge": {
      "packagerConfig": {
        "osxSign": {
          "identity": "Developer ID Application: Felix Rieseberg (LT94ZKYDCJ)",
          "hardened-runtime": true,
          "entitlements": "entitlements.plist",
          "entitlements-inherit": "entitlements.plist",
          "signature-flags": "library"
        },
        "osxNotarize": {
          "appleId": "felix@felix.fun",
          "appleIdPassword": "my-apple-id-password",
        }
      }
    }
  }
}
```

<br>

æ­¤å¤„å¼•ç”¨çš„ `plist` æ–‡ä»¶éœ€è¦ä»¥ä¸‹çš„ macOS ç‰¹å®šæƒé™æ¥ä¿è¯æ‚¨çš„åº”ç”¨æ­£åœ¨åšè¿™äº›äº‹æƒ…çš„è‹¹æœå®‰å…¨æœºåˆ¶å¹¶ä¸æ„å‘³ç€ä»»ä½•ä¼¤å®³ï¼š

<br>

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>com.apple.security.cs.allow-jit</key>
    <true/>
    <key>com.apple.security.cs.debugger</key>
    <true/>
  </dict>
</plist>
```

<br>

è¯·æ³¨æ„ï¼Œç›´åˆ°Electron 12, `com.apple.security.cs.allow-unsigned-executable-memory` çš„æƒé™éƒ½æ˜¯å¿…éœ€çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¯ä»¥é¿å…ï¼Œåˆ™ä¸åº”å†ä½¿ç”¨å®ƒã€‚

<br>

è¦æŸ¥çœ‹æ‰€æœ‰è¿™äº›éƒ½åœ¨æ“ä½œä¸­ï¼Œè¯·æŸ¥çœ‹ Electron Fiddle çš„æºä»£ç ï¼Œ(å°¤å…¶æ˜¯å…¶ `electron-forge` é…ç½®æ–‡ä»¶)[https://github.com/electron/fiddle/blob/master/forge.config.js]ã€‚

<br>

å¦‚æœæ‚¨æ‰“ç®—åœ¨åº”ç”¨ä¸­ä½¿ç”¨ Electron çš„ API è®¿é—®éº¦å…‹é£æˆ–æ‘„åƒå¤´ï¼Œæ‚¨è¿˜éœ€è¦æ·»åŠ ä»¥ä¸‹æƒé™ï¼š

```
<key>com.apple.security.device.audio-input</key>
<true/>
<key>com.apple.security.device.camera</key>
<true/>
```   

<br> å½“ä½ è°ƒç”¨åº”ç”¨æƒé™ä¸­æ²¡æœ‰çš„ä¸œè¥¿æ—¶, æ¯”å¦‚:

```
const { systemPreferences } = require('electron')

const microphone = systemPreferences.askForMediaAccess('microphone')
```

<br>

æ‚¨çš„åº”ç”¨å¯èƒ½ä¼šå´©æºƒã€‚ åœ¨ (Hardened Runtime)[https://developer.apple.com/documentation/security/hardened_runtime] ä¸­æŸ¥çœ‹èµ„æºè®¿é—®éƒ¨åˆ†ä»¥è·å–æ›´å¤šä¿¡æ¯å’Œæ‚¨å¯èƒ½éœ€è¦çš„æƒé™ã€‚

#### electron-builder

Electron Builder é™„å¸¦ä¸€ä¸ªè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆï¼Œç”¨äºç­¾ç½²åº”ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° (å®ƒçš„æ–‡æ¡£)[https://www.electron.build/code-signing]

#### electron-packager

å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨é›†æˆçš„æ„å»ºå·¥å…·æ¯”å¦‚ Forge æˆ– Builder, ä½ æ›´å€¾å‘äºä½¿ç”¨ (`electron-packager`)[https://github.com/electron/electron-packager] çš„è¯ï¼Œå¯ç”¨çš„æœ‰ (electron-osx-sign)[https://github.com/electron-userland/electron-osx-sign] å’Œ (electron-notarize)[https://github.com/electron/electron-notarize].

<br>

å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨Packagerçš„ APIï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½® (æ¥ç­¾åå¹¶å¯¹æ‚¨çš„åº”ç”¨ç¨‹åºè¿›è¡Œå…¬è¯)[https://electron.github.io/electron-packager/main/interfaces/electronpackager.options.html]

<br>

```
const packager = require('electron-packager')

packager({
  dir: '/path/to/my/app',
  osxSign: {
    identity: 'Developer ID Application: Felix Rieseberg (LT94ZKYDCJ)',
    'hardened-runtime': true,
    entitlements: 'entitlements.plist',
    'entitlements-inherit': 'entitlements.plist',
    'signature-flags': 'library'
  },
  osxNotarize: {
    appleId: 'felix@felix.fun',
    appleIdPassword: 'my-apple-id-password'
  }
})
```

<br>

æ­¤å¤„å¼•ç”¨çš„ `plist` æ–‡ä»¶éœ€è¦ä»¥ä¸‹çš„ macOS ç‰¹å®šæƒé™æ¥ä¿è¯æ‚¨çš„åº”ç”¨æ­£åœ¨åšè¿™äº›äº‹æƒ…çš„è‹¹æœå®‰å…¨æœºåˆ¶å¹¶ä¸æ„å‘³ç€ä»»ä½•ä¼¤å®³ï¼š

<br>

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
  <dict>
    <key>com.apple.security.cs.allow-jit</key>
    <true/>
    <key>com.apple.security.cs.debugger</key>
    <true/>
  </dict>
</plist>
```

<br>

è¯·æ³¨æ„ï¼Œç›´åˆ°Electron 12, `com.apple.security.cs.allow-unsigned-executable-memory` çš„æƒé™éƒ½æ˜¯å¿…éœ€çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¯ä»¥é¿å…ï¼Œåˆ™ä¸åº”å†ä½¿ç”¨å®ƒã€‚

#### Mac åº”ç”¨ç¨‹åºå•†åº—

è¯¦è§ (Mac App Store Guide)[https://www.electronjs.org/zh/docs/latest/tutorial/mac-app-store-submission-guide].

## ç­¾ç½²windowsåº”ç”¨ç¨‹åº

åœ¨ç­¾ç½²Windowsåº”ç”¨ç¨‹åºå‰ï¼Œä½ éœ€è¦å®Œæˆä»¥ä¸‹äº‹é¡¹ï¼š

<br>

- è·å–ä¸€ä¸ª Windows èº«ä»½éªŒè¯ç ç­¾åè¯ä¹¦ (éœ€è¦å¹´åº¦è´¹ç”¨)
- å®‰è£… Visual Studio ä»¥è·å–ç­¾åå·¥å…· (å…è´¹ (ç¤¾åŒºç‰ˆ)[https://visualstudio.microsoft.com/vs/community/] å·²è¶³å¤Ÿ)

<br>

æ‚¨å¯ä»¥ä»è®¸å¤šç»é”€å•†è·å¾—ä»£ç ç­¾åè¯ä¹¦ã€‚ ä»·æ ¼å„å¼‚ï¼Œæ‰€ä»¥å€¼å¾—ä½ èŠ±ç‚¹æ—¶é—´å»è´§æ¯”ä¸‰å®¶ã€‚ å¸¸è§ç»é”€å•†åŒ…æ‹¬ï¼š

<br>

- (digicert)[https://www.digicert.com/code-signing/microsoft-authenticode.htm]
- (Sectigo)[https://sectigo.com/ssl-certificates-tls/code-signing]
- é™¤å…¶ä»–å¤–ï¼Œè¯·è´§æ¯”ä¸‰å®¶åé€‰æ‹©é€‚åˆä½ çš„é‚£ä¸€æ¬¾ï¼ŒGoogle æ˜¯æ‚¨çš„æœ‹å‹ğŸ˜„ï¼š

<br>

ä½ å¯ä»¥è¿ç”¨è®¸å¤šæ–¹å¼æ¥ç­¾ç½²ä½ çš„åº”ç”¨ï¼š

<br>

- (`electron-winstaller`)[https://github.com/electron/windows-installer] å°†ç”Ÿæˆä¸€ä¸ªçª—å£å®‰è£…ç¨‹åºå¹¶ä¸ºä½ ç­¾å
- (`electron-forge`)[https://github.com/electron-userland/electron-forge] å¯ä»¥ä¸ºé€šè¿‡ Squirrel.Windows æˆ– MSI æ–¹å¼ç”Ÿæˆçš„å®‰è£…åŒ…ç”Ÿæˆç­¾å
- (`electron-builder`)[https://github.com/electron-userland/electron-builder] å¯ä»¥ä¸ºæŸäº› windows å¹³å°äº§å“ç”Ÿæˆç­¾å

#### Windows åº”ç”¨å•†åº—

å‚è€ƒ (Windows Store Guide)[https://www.electronjs.org/zh/docs/latest/tutorial/windows-store-guide].